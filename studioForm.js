(()=>{let t=typeof gsap,e=typeof Hammer,i='[bmg-form = "Form Block"]',o='[bmg-form = "Visual Divider"]',n='[bmg-form = "Backwards Button"]',a='[bmg-form = "Quiz Result"]',r=".w-radio",s=".w-form-done",d="bmg-data-form-block-index",u="bmg-data-step-index",l="bmg-data-step-type",c="bmg-data-conditional",m="bmg-data-click-element",f="bmg-data-click-element-id",p="bmg-data-autofocus",g="bmg-data-redirect-url",h=[{names:["false"],value:0},{names:["half","50%"],value:.5},{names:["on","true","100%"],value:1},{names:["extreme","200%"],value:2}],b="bmg-data-slide-direction",w="bmg-data-swipe-type-animation",v={opacity:1,display:"flex"},S={opacity:0,display:"none"},_={opacity:1,duration:.1},y={opacity:.5,duration:.1},T={...v},x={...S},I={...v},k={...S},M=[];function C(){$(i).each(function(t){"false"!=$(this).attr("bmg-data-auto-delete-conditionally-invisible-elements")&&$(this).find(".w-condition-invisible").remove();let e=$(this),r=W(e,'[bmg-form = "Form"]',0),s=W(r,'[bmg-form = "Form Step"]',"false",`${o}, ${a}`),l=r.find(n),c=r.find('[bmg-form = "Submit Button"]'),g=[{step:0}],h=!0,b=Y(e);G(e),b<2?(r.find(o).remove(),s.hide(),s.eq(0).show()):console.log(`Dev mode ${b}: Visual dividers not removed...`),e.attr(d,t),s.each(function(t){let i=$(this),o=!1,n=B(i,t,e);O(n),n.each(function(t){let e=$(this);e.attr(f,t),e.click(()=>{o||(setTimeout(()=>{o=!1},10),O(n,e),S()),o=!0})})}),l.each(function(){$(this).click(()=>{_()})}),c.each(function(){$(this).click(()=>{y()})});let v=N(s);function S(t=!1){let i=g[g.length-1].step,o=v[i];if(t&&"false"==o.swipeAllowed.toLowerCase())return;let n=o.$,a=n.find(`[${m} = "true"]`),s=a.attr(f);1==a.length?R(e,n)&&function t(e,i){let o=v[e].buttons[i].nextStepId;if(v[e].isLast)y();else{let n=v[e].$;$nextStep=v[o].$,g.push({step:o}),q(n,$nextStep,r,b)}b>.5&&console.log(`Dev mode ${b}; Click record: `,g)}(i,s):L(0,n,e)}function _(t=!1){let e=g[g.length-1].step,i=g[Math.max(g.length-2,0)].step;if(!t||"false"!=v[e].swipeAllowed.toLowerCase()){if(e!=i){let o=r.find(`[${u} = "${e}"]`),n=r.find(`[${u} = "${i}"]`);g.pop(),q(o,n,r,b)}b>.5&&console.log(`Dev mode ${b}; Click record: `,g)}}function y(){h=!1,P(v,g,e),z(e,g),D(e,r,b)}0==t&&e.attr(p,!0),e.mouseenter(()=>{$(i).attr(p,!1),e.attr(p,!0)});let T=(e.attr("bmg-data-esc-event")||"escape, esc, arrowup, up").split(", "),x=(e.attr("bmg-data-enter-event")||"enter, arrowdown, down").split(", "),I=(e.attr("bmg-data-left-event")||"arrowleft, left").split(", "),k=(e.attr("bmg-data-right-event")||"arrowright, right").split(", ");document.onkeydown=function(t){t=t||window.event;let i=g[g.length-1].step;if("false"!=r.find(`[${u} = "${i}"]`).attr("bmg-data-keyboard-events")&&"key"in t&&h&&"true"==e.attr(p)){let o=t.key.toLowerCase();T.includes(o)?_():x.includes(o)&&!t.shiftKey?S():I.includes(o)&&!t.shiftKey?E(-1):k.includes(o)&&!t.shiftKey&&E(1)}};let C="true"==M[t].leftRightKeyEventInfinityAllowed;function E(t=1){let i=v[g[g.length-1].step].$,o=i.find(`[${f}]`).length-1,n=parseInt(i.find(`[${m} = "true"]`).attr(f)||-2),a=-2==n?0:n+t;L(a=C?(a=a>o?0:a)<0?o:a:(a=a>o?o:a)<0?0:a,i,e)}A(e);let H=Hammer(e[0]),j=e.attr(w);"false"==j||("to bottom"==j?(H.get("swipe").set({direction:Hammer.DIRECTION_ALL}),H.on("swipeup",()=>{_(!0)}),H.on("swipedown",()=>{S(!0)})):"to top"==j||"vertical"==j?(H.get("swipe").set({direction:Hammer.DIRECTION_ALL}),H.on("swipeup",()=>{S(!0)}),H.on("swipedown",()=>{_(!0)})):"to left"==j||"default"==j||"horizontal"==j?(H.on("swipeleft",()=>{S(!0)}),H.on("swiperight",()=>{_(!0)})):"to right"==j?(H.on("swipeleft",()=>{_(!0)}),H.on("swiperight",()=>{S(!0)})):"4"==j||"270\xb0"==j?(H.get("swipe").set({direction:Hammer.DIRECTION_ALL}),H.on("swipeup",()=>{_(!0)}),H.on("swipeleft",()=>{S(!0)}),H.on("swiperight",()=>{S(!0)}),H.on("swipedown",()=>{_(!0)})):"3"==j||"180\xb0"==j?(H.get("swipe").set({direction:Hammer.DIRECTION_ALL}),H.on("swipeup",()=>{_(!0)}),H.on("swipeleft",()=>{S(!0)}),H.on("swiperight",()=>{S(!0)}),H.on("swipedown",()=>{_(!0)})):"2"==j||"90\xb0"==j?(H.get("swipe").set({direction:Hammer.DIRECTION_ALL}),H.on("swipeup",()=>{_(!0)}),H.on("swipeleft",()=>{S(!0)}),H.on("swiperight",()=>{S(!0)}),H.on("swipedown",()=>{_(!0)})):(H.get("swipe").set({direction:Hammer.DIRECTION_ALL}),H.on("swipeup",()=>{S(!0)}),H.on("swipeleft",()=>{S(!0)}),H.on("swiperight",()=>{_(!0)}),H.on("swipedown",()=>{_(!0)})))})}function E(t="add",e,i){let o=M[i],n=o.cssErrorStatus,a=o.cssErrorStatusResolved,r=K(e);"add"==t?gsap.to(r,n):gsap.to(r,a)}function R(t,e){let i=e.attr(l),o="true"==(e.attr("bmg-data-required")||"true");if(styleIndex=parseInt(t.attr(d)),!o||"empty"==i)return!0;if("checkbox"==i)return console.log(`Please continue to programm the required checking functionality for ${i} step types.`),!0;if("radio"==i){let n=e.find(r),a=n.find(".w--redirected-checked");return!!e.find(`[${f}]`).hasClass(r.substring(1))||0!=a.length||(E("add",n,styleIndex),n.off("click.stepRequirements"),n.on("click.stepRequirements",function(){E("remove",n,styleIndex),n.off("click.stepRequirements")}),!1)}console.log(`Please continue to programm the required checking functionality for ${i} step types.`),console.log("TODO: Implement required checking. If error thrown, let left right event navigate through individual inputs -- enter & ecs should be functional in there as well.")}function L(t,e,i){let o=M[parseInt(i.attr(d))],n=o.cssDeselect,a=o.cssSelect,r=e.find(`[${f}]`),s=K(r),u=e.find(`[${f} = ${t}]`);O(r,u),gsap.to(s,n),gsap.to(u[0],a)}function z(t,e){let i=t[0].querySelector(s).querySelectorAll(a),o=M[parseInt(t.attr(d))].redirectMsTime;if(i.length>0){console.log(i);let n=i[0],r=n.getAttribute(g);if(void 0!=r){setTimeout(()=>{r=n.getAttribute(g),location.assign(r)},o);return}console.log("Todo: Set up quiz mode funcitonality. Url functionality, nested forms, etc.")}}function A(t){let e=parseInt(t.attr(d)),i=t.attr(w),o=M[e],n=o.slideDirection.toLowerCase(),a=o.maxSwipeScreenSize,r=o.minSwipeScreenSize,s=$(window).outerWidth(!0);s<=a&&s>=r?(void 0!=i&&(n=i),t.attr(w,n)):t.attr(w,"false")}function D(t,e,i=0,o=[]){let n=t.find(s),a=M[t.attr(d)],r=a.submitMsTime1/1e3,u=a.submitMsTime2/1e3,l=a.submitHide,c={...l,duration:0};submitShow=a.submitShow,resizeHeight1=e.outerHeight(!0),resizeHeight2=n.outerHeight(!0),multiplier1=a.autoResizeSuccessTimeMultiplier1,multiplier2=a.autoResizeSuccessTimeMultiplier2,submitTimeout=(l.duration+submitShow.duration)*1e3,tl=new gsap.timeline,resizeTl=new gsap.timeline,i<.5?setTimeout(e.submit(),submitTimeout):console.log(`Dev mode ${i}: Perform fake submit...`),tl.set(n[0],c),tl.to(e[0],l),tl.to(n[0],submitShow),resizeHeight2>=resizeHeight1?resizeTl.to(t[0],{height:resizeHeight2,duration:r*multiplier1}):(resizeTl.set(t[0],{height:resizeHeight1}),resizeTl.to(t[0],{height:resizeHeight2,duration:u*multiplier2}).delay(r)),resizeTl.set(t[0],{height:"auto"})}let H=!1;function q(t,e,o,n=0){if(n>=2){console.log(`Dev mode ${n}: Block the transition animation...`);return}let a=o.find(`[${u}]`).not(t).not(e),r=M[parseInt(o.closest(i).attr(d))],s=r.cssShow,l=r.cssHide,c={...l,duration:0},m=new gsap.timeline,f=t.outerHeight(!0),p=e.outerHeight(!0);if(speedMultiplierString=`<+=${100*(f==p?r.equalHeightTransitionSpeedMultiplier:1)}%`,isReverse=parseInt(t.attr(u))>parseInt(e.attr(u)),slideDirection=(t.attr(b)||r.slideDirection).toLowerCase(),autoResizeTime1=s.duration,autoResizeTime2=l.duration,autoResizeTimeMultiplier1=r.autoResizeTimeMultiplier1,autoResizeTimeMultiplier2=r.autoResizeTimeMultiplier2,isReverse&&(slideDirection=(e.attr(b)||slideDirection).toLowerCase()),n>=2&&console.log(`Dev mode ${n}; GSAP transition speed multiplier string: ${speedMultiplierString}`),"to bottom"==slideDirection){let g={...s,y:0},h={...l,y:-o.outerHeight(!0)},w={...h,duration:0},v={...s,y:0},S={...l,y:o.outerHeight(!0)},_={...S,duration:0};isReverse?(m.to(t[0],h),m.fromTo(e[0],_,v,speedMultiplierString)):(m.to(t[0],S),m.fromTo(e[0],w,g,speedMultiplierString))}else if("to top"==slideDirection){let y={...s,y:0},T={...l,y:-o.outerHeight(!0)},x={...T,duration:0},I={...s,y:0},k={...l,y:o.outerHeight(!0)},C={...k,duration:0};isReverse?(m.to(t[0],k),m.fromTo(e[0],x,y,speedMultiplierString)):(m.to(t[0],T),m.fromTo(e[0],C,I,speedMultiplierString))}else if("to left"==slideDirection||"default"==slideDirection){let E={...s,x:0},R={...l,x:-o.outerWidth(!0)},L={...R,duration:0},z={...s,x:0},A={...l,x:o.outerWidth(!0)},D={...A,duration:0};isReverse?(m.to(t[0],A),m.fromTo(e[0],L,E,speedMultiplierString)):(m.to(t[0],R),m.fromTo(e[0],D,z,speedMultiplierString))}else if("to right"==slideDirection){let q={...s,x:0},N={...l,x:-o.outerWidth(!0)},O={...N,duration:0},P={...s,x:0},j={...l,x:o.outerWidth(!0)},B={...j,duration:0};isReverse?(m.to(t[0],N),m.fromTo(e[0],B,P,speedMultiplierString)):(m.to(t[0],j),m.fromTo(e[0],O,q,speedMultiplierString))}else if("none"==slideDirection)m.to(t[0],l),m.fromTo(e[0],c,s);else{let W=r.customNextSlideIn,K=r.customNextSlideOut,F=r.customPrevSlideIn,V=r.customPrevSlideOut,X=r.customXMultiplier,Y=r.customYMultiplier;void 0==W.x&&(W.x=0),void 0==K.x&&(K.x=X*o.outerWidth(!0)),void 0==F.x&&(F.x=0),void 0==V.x&&(V.x=-X*o.outerWidth(!0)),void 0==W.y&&(W.y=0),void 0==K.y&&(K.y=Y*o.outerHeight(!0)),void 0==F.y&&(F.y=0),void 0==V.y&&(V.y=-Y*o.outerHeight(!0));let G={...V,duration:0},Q={...K,duration:0};isReverse?(autoResizeTime1=F.duration,autoResizeTime2=V.duration,m.to(t[0],V),m.fromTo(e[0],Q,F,speedMultiplierString)):(autoResizeTime1=W.duration,autoResizeTime2=K.duration,m.to(t[0],K),m.fromTo(e[0],G,W,speedMultiplierString))}p>=f?gsap.to(o[0],{height:p,duration:autoResizeTime1*autoResizeTimeMultiplier1}):(gsap.set(o[0],{height:f}),gsap.to(o[0],{height:p,duration:autoResizeTime2*autoResizeTimeMultiplier2}).delay(autoResizeTime1)),H&&H.clear(),H=m,a.hide()}function N(t){let e=[];t.each(function(t){let i=$(this),o=i.find(`[${f}]`),n=[];o.each(function(){let t=$(this);n.push({id:t.attr(f),conditional:t.attr(c)})}),e.push({$:i,step:t,swipeAllowed:i.attr("bmg-data-swipe-allowed")||"true",conditional:i.attr(c),conditionalNext:i.attr("bmg-data-conditional-next"),buttons:n})});let i=e.length;return e.forEach(t=>{let o=t.step,n=t.$.attr("bmg-data-relative-last-step");t.isLast=o==i-1,"true"==n&&(t.isLast=!0),t.buttons.forEach(i=>{void 0!=i.conditional?i.nextStepId=(()=>{for(t of e)if(t.conditional==i.conditional)return t.step})():void 0!=t.conditionalNext?i.nextStepId=o+1:i.nextStepId=(()=>{for(t of e)if(t.step>o&&void 0==t.conditional)return t.step})()})}),e}function O(t,e=!1){t.attr(m,!1),e&&e.attr(m,!0)}function P(t,e,i){"true"==(i.attr("bmg-data-remove-other-steps")||"true")&&t.forEach(t=>{let i=!1,o=t.step;e.forEach(t=>{o==t.step&&(i=!0)}),t.isLast&&(i=!0),i||t.$.remove()})}function j(t,e,i){let o=M[e],n=o.cssActive,a=o.cssInactive,r=o.setCssInactive,s="radio"==i.attr(l),d=K(t);gsap.set(d,r),s?t.each(function(){let t=$(this);t.click(()=>{gsap.to(d,a),gsap.to(t[0],n)})}):t.each(function(){let t=$(this),e=!0,i=!1;t.click(()=>{i||(setTimeout(()=>{i=!1},10),e?(t.css(n),e=!1):(t.css(a),e=!0)),i=!0})})}function B(t,e,i){let o=t.find(r),a=t.find(".w-checkbox"),s=t.find('a, [bmg-form = "Continue Button"], .w-button').not('[bmg-form = "Not a Button"]').not(n),c=t.find("input"),m=parseInt(i.attr(d));return(t.attr(u,e),o.length>0)?(t.attr(l,"radio"),j(o,m,t),o.find("input").removeAttr("required"),void 0!=t.attr("bmg-data-not-auto-continue")?s:o):a.length>0?(t.attr(l,"checkbox"),j(a,m,t),s):c.length>0?(t.attr(l,"other input"),j(a,m,t),s):(t.attr(l,"empty"),s)}function W(t,e,i="false",o="false"){let n=t.find(e),a=t.children();return n.length>0?n:("false"!=o&&(a=a.not(o)),"false"!=i&&(a=a.eq(i)),a)}function K(t){let e=[];return t.each(function(){e.push(this)}),e}function F(t,e,i,o=!0){return"{}"==(t.attr(e)||"{}")?{...i}:JSON.parse(V(t.attr(e),!0))}function V(t,e=!0){let i=X(t.replace(", ",",")).split(","),o="",n=i.length-1;return(i.forEach((t,e)=>{t.replace(/\'/g,"").replace(": ",":").split(":").forEach((t,e)=>{o+=`"${t}"${e>0?"":": "}`}),o+=e<n?", ":""}),e)?`{${o}}`:o}function X(t){return t.substring(1).slice(0,-1)}function Y(t){let e=t.attr("bmg-data-dev-mode"),i=0;return h.forEach(t=>{t.names.forEach(o=>{o==e&&(i=t.value)})}),i}function G(t){M.push({animationMsTime:parseFloat(t.attr("bmg-data-animation-ms-time")||500),equalHeightTransitionSpeedMultiplier:parseFloat(t.attr("bmg-data-equal-height-transition-speed-multiplier")||.25),cssShow:F(t,"bmg-data-css-show",v),cssHide:F(t,"bmg-data-css-hide",S),cssActive:F(t,"bmg-data-css-active",_),cssInactive:F(t,"bmg-data-css-inactive",y),errorColor:t.attr("bmg-data-error-color")||"red",slideDirection:t.attr(b)||"to left",customNextSlideIn:F(t,"bmg-data-custom-next-slide-in",T),customNextSlideOut:F(t,"bmg-data-custom-next-slide-out",x),customPrevSlideIn:F(t,"bmg-data-custom-prev-slide-in",I),customPrevSlideOut:F(t,"bmg-data-custom-prev-slide-out",k),customXMultiplier:parseFloat(t.attr("bmg-data-custom-x-percentage-multiplier")||0),customYMultiplier:parseFloat(t.attr("bmg-data-custom-y-percentage-multiplier")||0),autoResizeTimeMultiplier1:parseFloat(t.attr("bmg-data-auto-resize-time-multiplier-1")||1),autoResizeTimeMultiplier2:parseFloat(t.attr("bmg-data-auto-resize-time-multiplier-2")||.5),autoResizeSuccessTimeMultiplier1:parseFloat(t.attr("bmg-data-auto-resize-time-multiplier-1")||1),autoResizeSuccessTimeMultiplier2:parseFloat(t.attr("bmg-data-auto-resize-time-multiplier-2")||.85),maxSwipeScreenSize:parseInt(t.attr("bmg-data-max-swipe-screen-size")||767),minSwipeScreenSize:parseInt(t.attr("bmg-data-min-swipe-screen-size")||0),leftRightKeyEventInfinityAllowed:t.attr("bmg-data-left-key-event-infintiy-allowed")||"true",redirectMsTime:parseFloat(t.attr("bmg-data-redirect-ms-time")||1)});let e=M[M.length-1],i=e.cssShow,o=e.cssHide,n=e.cssActive,a=e.cssInactive,r=e.customNextSlideIn,s=e.customNextSlideOut,d=e.customPrevSlideIn,u=e.customPrevSlideOut;e.animationSTime=e.animationMsTime/1e3,void 0==i.duration&&(i.duration=e.animationSTime),void 0==o.duration&&(o.duration=e.animationSTime),void 0==n.duration&&(n.duration=e.animationSTime),void 0==a.duration&&(a.duration=e.animationSTime),void 0==r.duration&&(r.duration=e.animationSTime),void 0==s.duration&&(s.duration=e.animationSTime),void 0==d.duration&&(d.duration=e.animationSTime),void 0==u.duration&&(u.duration=e.animationSTime),e.submitMsTime1=parseFloat(t.attr("bmg-data-submit-ms-time-1"))||e.animationMsTime,e.submitMsTime2=parseFloat(t.attr("bmg-data-submit-ms-time-2"))||e.animationMsTime,e.submitHide=F(t,"bmg-data-submit-hide",o),e.submitShow=F(t,"bmg-data-submit-show",{...i,duration:1.5*e.animationSTime}),void 0==e.submitHide.duration&&(e.submitHide.duration=e.submitMsTime1/1e3),void 0==e.submitShow.duration&&(e.submitShow.duration=e.submitMsTime2/1e3),e.setCssInactive=F(t,"bmg-data-set-css-inactive",a),delete e.setCssInactive.duration,e.cssSelect=F(t,"bmg-data-css-select",n),e.cssDeselect=F(t,"bmg-data-css-deselect",a),e.cssErrorStatus=F(t,"bmg-data-css-error-status",{duration:e.animationSTime}),e.cssErrorStatusResolved=F(t,"bmg-data-css-error-status-resolved",{duration:e.animationSTime}),void 0==e.cssErrorStatus.borderColor&&(e.cssErrorStatus.borderColor=e.errorColor),void 0==e.cssErrorStatusResolved.borderColor&&(e.cssErrorStatusResolved.borderColor="")}function Q(){"undefined"==t?$.loadScript("https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/gsap.min.js",function(){C()}):C()}jQuery.loadScript=function(t,e){jQuery.ajax({url:t,dataType:"script",success:e,async:!0})},"undefined"==e?$.loadScript("https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js",function(){Q()}):Q()})();
