(()=>{let t=typeof gsap,e=typeof Hammer,i='[bmg-form = "Form Block"]',o='[bmg-form = "Visual Divider"]',a='[bmg-form = "Backwards Button"]',n='[bmg-form = "Quiz Result"]',r=".w-radio",s=".w-form-done",d="bmg-data-form-block-index",u="bmg-data-step-index",l="bmg-data-step-type",m="bmg-data-conditional",c="bmg-data-click-element",f="bmg-data-click-element-id",p="bmg-data-autofocus",h="bmg-data-redirect-url",g=[{names:["false"],value:0},{names:["half","50%"],value:.5},{names:["on","true","100%"],value:1},{names:["extreme","200%"],value:2}],b="bmg-data-slide-direction",v="bmg-data-swipe-type-animation",w={opacity:1,display:"flex"},S={opacity:0,display:"none"},_={opacity:1,duration:.1},y={opacity:.5,duration:.1},T={...w},x={...S},M={...w},k={...S},I=[];function z(){$(i).each(function(t){"false"!=$(this).attr("bmg-data-auto-delete-conditionally-invisible-elements")&&$(this).find(".w-condition-invisible").remove();let e=$(this),r=K(e,'[bmg-form = "Form"]',0),s=K(r,'[bmg-form = "Form Step"]',"false",`${o}, ${n}`),l=r.find(a),m=r.find('[bmg-form = "Submit Button"]'),h=[{step:0}],g=!0,b=G(e);P(e),b<2?(r.find(o).remove(),s.hide(),s.eq(0).show()):console.log(`Dev mode ${b}: Visual dividers not removed...`),e.attr(d,t),s.each(function(t){let i=$(this),o=!1,a=W(i,t,e);j(a),a.each(function(t){let e=$(this);e.attr(f,t),e.click(()=>{o||(setTimeout(()=>{o=!1},10),j(a,e),S()),o=!0})})}),l.each(function(){$(this).click(()=>{T()})}),m.each(function(){$(this).click(()=>{x()})});let w=O(s);function S(t=!1){let i=h[h.length-1].step,o=w[i];if(t&&"false"==o.swipeAllowed.toLowerCase())return;let a=o.$,n=a.find(`[${c} = "true"]`),s=n.attr(f);1==n.length?E(e,a)&&function t(e,i){let o=w[e].buttons[i].nextStepId;if(w[e].isLast)x();else{let a=w[e].$;$nextStep=w[o].$,h.push({step:o}),L(a,$nextStep,r,b)}b>.5&&console.log(`Dev mode ${b}; Click record: `,h)}(i,s):H(0,a,e)}let _="true"==I[t].leftRightKeyEventInfinityAllowed;function y(t=1){let i=w[h[h.length-1].step].$,o=i.find(`[${f}]`).length-1,a=parseInt(i.find(`[${c} = "true"]`).attr(f)||-2),n=-2==a?0:a+t;H(n=_?(n=n>o?0:n)<0?o:n:(n=n>o?o:n)<0?0:n,i,e)}function T(t=!1){let e=h[h.length-1].step,i=h[Math.max(h.length-2,0)].step;if(!t||"false"!=w[e].swipeAllowed.toLowerCase()){if(e!=i){let o=r.find(`[${u} = "${e}"]`),a=r.find(`[${u} = "${i}"]`);h.pop(),L(o,a,r,b)}b>.5&&console.log(`Dev mode ${b}; Click record: `,h)}}function x(){g=!1,N(w,h,e),R(e,h),D(e,r,b)}0==t&&e.attr(p,!0),e.mouseenter(()=>{$(i).attr(p,!1),e.attr(p,!0)});let M=(e.attr("bmg-data-esc-event")||"escape, esc, arrowup, up").split(", "),k=(e.attr("bmg-data-enter-event")||"enter, arrowdown, down").split(", "),z=(e.attr("bmg-data-left-event")||"arrowleft, left").split(", "),C=(e.attr("bmg-data-right-event")||"arrowright, right").split(", ");document.onkeydown=function(t){t=t||window.event;let i=h[h.length-1].step;if("false"!=r.find(`[${u} = "${i}"]`).attr("bmg-data-keyboard-events")&&"key"in t&&g&&"true"==e.attr(p)){let o=t.key.toLowerCase();M.includes(o)?T():k.includes(o)&&!t.shiftKey?S():z.includes(o)&&!t.shiftKey?y(-1):C.includes(o)&&!t.shiftKey&&y(1)}},A(e);let q=Hammer(e[0]),B=e.attr(v);q.get("swipe").set({direction:Hammer.DIRECTION_ALL}),"false"==B||("to bottom"==B?(q.on("swipeup",()=>{T(!0)}),q.on("swipedown",()=>{S(!0)})):"to top"==B||"vertical"==B?(q.on("swipeup",()=>{S(!0)}),q.on("swipedown",()=>{T(!0)})):"to left"==B||"default"==B||"horizontal"==B?(q.on("swipeleft",()=>{S(!0)}),q.on("swiperight",()=>{T(!0)})):"to right"==B?(q.on("swipeleft",()=>{T(!0)}),q.on("swiperight",()=>{S(!0)})):"4"==B||"270\xb0"==B?(q.on("swipeup",()=>{T(!0)}),q.on("swipeleft",()=>{S(!0)}),q.on("swiperight",()=>{S(!0)}),q.on("swipedown",()=>{T(!0)})):"3"==B||"180\xb0"==B?(q.on("swipeup",()=>{T(!0)}),q.on("swipeleft",()=>{S(!0)}),q.on("swiperight",()=>{S(!0)}),q.on("swipedown",()=>{T(!0)})):"2"==B||"90\xb0"==B?(q.on("swipeup",()=>{T(!0)}),q.on("swipeleft",()=>{S(!0)}),q.on("swiperight",()=>{S(!0)}),q.on("swipedown",()=>{T(!0)})):(q.on("swipeup",()=>{S(!0)}),q.on("swipeleft",()=>{S(!0)}),q.on("swiperight",()=>{T(!0)}),q.on("swipedown",()=>{T(!0)})))})}function C(t="add",e,i){let o=I[i],a=o.cssErrorStatus,n=o.cssErrorStatusResolved,r=F(e);"add"==t?gsap.to(r,a):gsap.to(r,n)}function E(t,e){let i=e.attr(l),o=parseInt(t.attr(d));if("empty"==i)return!0;if("radio"==i){let a=e.find(r);return 0!=a.find(".w--redirected-checked").length||(C("add",a,o),a.on("click.stepRequirements",function(){C("remove",a,o),a.off("click.stepRequirements")}),!1)}console.log("TODO: Implement required checking. If error thrown, let left right event navigate through individual inputs -- enter & ecs should be functional in there as well.")}function H(t,e,i){let o=I[parseInt(i.attr(d))],a=o.cssDeselect,n=o.cssSelect,r=e.find(`[${f}]`),s=F(r),u=e.find(`[${f} = ${t}]`);j(r,u),gsap.to(s,a),gsap.to(u[0],n)}function R(t,e){let i=t[0].querySelector(s).querySelectorAll(n),o=I[parseInt(t.attr(d))].redirectMsTime;if(i.length>0){console.log(i);let a=i[0],r=a.getAttribute(h);if(void 0!=r){setTimeout(()=>{r=a.getAttribute(h),location.assign(r)},o);return}console.log("Todo: Set up quiz mode funcitonality. Url functionality, nested forms, etc.")}}function A(t){let e=parseInt(t.attr(d)),i=t.attr(v),o=I[e],a=o.slideDirection.toLowerCase(),n=o.maxSwipeScreenSize,r=o.minSwipeScreenSize,s=$(window).outerWidth(!0);s<=n&&s>=r?(void 0!=i&&(a=i),t.attr(v,a)):t.attr(v,"false")}function D(t,e,i=0,o=[]){let a=t.find(s),n=I[t.attr(d)],r=n.submitMsTime1/1e3,u=n.submitMsTime2/1e3,l=n.submitHide,m={...l,duration:0};submitShow=n.submitShow,resizeHeight1=e.outerHeight(!0),resizeHeight2=a.outerHeight(!0),multiplier1=n.autoResizeSuccessTimeMultiplier1,multiplier2=n.autoResizeSuccessTimeMultiplier2,submitTimeout=(l.duration+submitShow.duration)*1e3,tl=new gsap.timeline,resizeTl=new gsap.timeline,i<.5?setTimeout(e.submit(),submitTimeout):console.log(`Dev mode ${i}: Perform fake submit...`),tl.set(a[0],m),tl.to(e[0],l),tl.to(a[0],submitShow),resizeHeight2>=resizeHeight1?resizeTl.to(t[0],{height:resizeHeight2,duration:r*multiplier1}):(resizeTl.set(t[0],{height:resizeHeight1}),resizeTl.to(t[0],{height:resizeHeight2,duration:u*multiplier2}).delay(r)),resizeTl.set(t[0],{height:"auto"})}let q=!1;function L(t,e,o,a=0){if(a>=2){console.log(`Dev mode ${a}: Block the transition animation...`);return}let n=o.find(`[${u}]`).not(t).not(e),r=I[parseInt(o.closest(i).attr(d))],s=r.cssShow,l=r.cssHide,m={...l,duration:0},c=new gsap.timeline,f=t.outerHeight(!0),p=e.outerHeight(!0);if(speedMultiplierString=`<+=${100*(f==p?r.equalHeightTransitionSpeedMultiplier:1)}%`,isReverse=parseInt(t.attr(u))>parseInt(e.attr(u)),slideDirection=(t.attr(b)||r.slideDirection).toLowerCase(),autoResizeTime1=s.duration,autoResizeTime2=l.duration,autoResizeTimeMultiplier1=r.autoResizeTimeMultiplier1,autoResizeTimeMultiplier2=r.autoResizeTimeMultiplier2,isReverse&&(slideDirection=(e.attr(b)||slideDirection).toLowerCase()),a>=2&&console.log(`Dev mode ${a}; GSAP transition speed multiplier string: ${speedMultiplierString}`),"to bottom"==slideDirection){let h={...s,y:0},g={...l,y:-o.outerHeight(!0)},v={...g,duration:0},w={...s,y:0},S={...l,y:o.outerHeight(!0)},_={...S,duration:0};isReverse?(c.to(t[0],g),c.fromTo(e[0],_,w,speedMultiplierString)):(c.to(t[0],S),c.fromTo(e[0],v,h,speedMultiplierString))}else if("to top"==slideDirection){let y={...s,y:0},T={...l,y:-o.outerHeight(!0)},x={...T,duration:0},M={...s,y:0},k={...l,y:o.outerHeight(!0)},z={...k,duration:0};isReverse?(c.to(t[0],k),c.fromTo(e[0],x,y,speedMultiplierString)):(c.to(t[0],T),c.fromTo(e[0],z,M,speedMultiplierString))}else if("to left"==slideDirection||"default"==slideDirection){let C={...s,x:0},E={...l,x:-o.outerWidth(!0)},H={...E,duration:0},R={...s,x:0},A={...l,x:o.outerWidth(!0)},D={...A,duration:0};isReverse?(c.to(t[0],A),c.fromTo(e[0],H,C,speedMultiplierString)):(c.to(t[0],E),c.fromTo(e[0],D,R,speedMultiplierString))}else if("to right"==slideDirection){let L={...s,x:0},N={...l,x:-o.outerWidth(!0)},O={...N,duration:0},j={...s,x:0},P={...l,x:o.outerWidth(!0)},B={...P,duration:0};isReverse?(c.to(t[0],N),c.fromTo(e[0],B,j,speedMultiplierString)):(c.to(t[0],P),c.fromTo(e[0],O,L,speedMultiplierString))}else if("none"==slideDirection)c.to(t[0],l),c.fromTo(e[0],m,s);else{let W=r.customNextSlideIn,K=r.customNextSlideOut,F=r.customPrevSlideIn,V=r.customPrevSlideOut,X=r.customXMultiplier,Y=r.customYMultiplier;void 0==W.x&&(W.x=0),void 0==K.x&&(K.x=X*o.outerWidth(!0)),void 0==F.x&&(F.x=0),void 0==V.x&&(V.x=-X*o.outerWidth(!0)),void 0==W.y&&(W.y=0),void 0==K.y&&(K.y=Y*o.outerHeight(!0)),void 0==F.y&&(F.y=0),void 0==V.y&&(V.y=-Y*o.outerHeight(!0));let G={...V,duration:0},Q={...K,duration:0};isReverse?(autoResizeTime1=F.duration,autoResizeTime2=V.duration,c.to(t[0],V),c.fromTo(e[0],Q,F,speedMultiplierString)):(autoResizeTime1=W.duration,autoResizeTime2=K.duration,c.to(t[0],K),c.fromTo(e[0],G,W,speedMultiplierString))}p>=f?gsap.to(o[0],{height:p,duration:autoResizeTime1*autoResizeTimeMultiplier1}):(gsap.set(o[0],{height:f}),gsap.to(o[0],{height:p,duration:autoResizeTime2*autoResizeTimeMultiplier2}).delay(autoResizeTime1)),q&&q.clear(),q=c,n.hide()}function N(t,e,i){"true"==(i.attr("bmg-data-remove-other-steps")||"true")&&t.forEach(t=>{let i=!1,o=t.step;e.forEach(t=>{o==t.step&&(i=!0)}),t.isLast&&(i=!0),i||t.$.remove()})}function O(t){let e=[];t.each(function(t){let i=$(this),o=i.find(`[${f}]`),a=[];o.each(function(){let t=$(this);a.push({id:t.attr(f),conditional:t.attr(m)})}),e.push({$:i,step:t,swipeAllowed:i.attr("bmg-data-swipe-allowed")||"true",conditional:i.attr(m),conditionalNext:i.attr("bmg-data-conditional-next"),buttons:a})});let i=e.length;return e.forEach(t=>{let o=t.step,a=t.$.attr("bmg-data-relative-last-step");t.isLast=o==i-1,"true"==a&&(t.isLast=!0),t.buttons.forEach(i=>{void 0!=i.conditional?i.nextStepId=(()=>{for(t of e)if(t.conditional==i.conditional)return t.step})():void 0!=t.conditionalNext?i.nextStepId=o+1:i.nextStepId=(()=>{for(t of e)if(t.step>o&&void 0==t.conditional)return t.step})()})}),e}function j(t,e=!1){t.attr(c,!1),e&&e.attr(c,!0)}function P(t){I.push({animationMsTime:parseFloat(t.attr("bmg-data-animation-ms-time")||500),equalHeightTransitionSpeedMultiplier:parseFloat(t.attr("bmg-data-equal-height-transition-speed-multiplier")||.25),cssShow:V(t,"bmg-data-css-show",w),cssHide:V(t,"bmg-data-css-hide",S),cssActive:V(t,"bmg-data-css-active",_),cssInactive:V(t,"bmg-data-css-inactive",y),errorColor:t.attr("bmg-data-error-color")||"red",slideDirection:t.attr(b)||"to left",customNextSlideIn:V(t,"bmg-data-custom-next-slide-in",T),customNextSlideOut:V(t,"bmg-data-custom-next-slide-out",x),customPrevSlideIn:V(t,"bmg-data-custom-prev-slide-in",M),customPrevSlideOut:V(t,"bmg-data-custom-prev-slide-out",k),customXMultiplier:parseFloat(t.attr("bmg-data-custom-x-percentage-multiplier")||0),customYMultiplier:parseFloat(t.attr("bmg-data-custom-y-percentage-multiplier")||0),autoResizeTimeMultiplier1:parseFloat(t.attr("bmg-data-auto-resize-time-multiplier-1")||1),autoResizeTimeMultiplier2:parseFloat(t.attr("bmg-data-auto-resize-time-multiplier-2")||.5),autoResizeSuccessTimeMultiplier1:parseFloat(t.attr("bmg-data-auto-resize-time-multiplier-1")||1),autoResizeSuccessTimeMultiplier2:parseFloat(t.attr("bmg-data-auto-resize-time-multiplier-2")||.85),maxSwipeScreenSize:parseInt(t.attr("bmg-data-max-swipe-screen-size")||767),minSwipeScreenSize:parseInt(t.attr("bmg-data-min-swipe-screen-size")||0),leftRightKeyEventInfinityAllowed:t.attr("bmg-data-left-key-event-infintiy-allowed")||"true",redirectMsTime:parseFloat(t.attr("bmg-data-redirect-ms-time")||1)});let e=I[I.length-1],i=e.cssShow,o=e.cssHide,a=e.cssActive,n=e.cssInactive,r=e.customNextSlideIn,s=e.customNextSlideOut,d=e.customPrevSlideIn,u=e.customPrevSlideOut;e.animationSTime=e.animationMsTime/1e3,void 0==i.duration&&(i.duration=e.animationSTime),void 0==o.duration&&(o.duration=e.animationSTime),void 0==a.duration&&(a.duration=e.animationSTime),void 0==n.duration&&(n.duration=e.animationSTime),void 0==r.duration&&(r.duration=e.animationSTime),void 0==s.duration&&(s.duration=e.animationSTime),void 0==d.duration&&(d.duration=e.animationSTime),void 0==u.duration&&(u.duration=e.animationSTime),e.submitMsTime1=parseFloat(t.attr("bmg-data-submit-ms-time-1"))||e.animationMsTime,e.submitMsTime2=parseFloat(t.attr("bmg-data-submit-ms-time-2"))||e.animationMsTime,e.submitHide=V(t,"bmg-data-submit-hide",o),e.submitShow=V(t,"bmg-data-submit-show",{...i,duration:1.5*e.animationSTime}),void 0==e.submitHide.duration&&(e.submitHide.duration=e.submitMsTime1/1e3),void 0==e.submitShow.duration&&(e.submitShow.duration=e.submitMsTime2/1e3),e.setCssInactive=V(t,"bmg-data-set-css-inactive",n),delete e.setCssInactive.duration,e.cssSelect=V(t,"bmg-data-css-select",a),e.cssDeselect=V(t,"bmg-data-css-deselect",n),e.cssErrorStatus=V(t,"bmg-data-css-error-status",{duration:e.animationSTime}),e.cssErrorStatusResolved=V(t,"bmg-data-css-error-status-resolved",{duration:e.animationSTime}),void 0==e.cssErrorStatus.borderColor&&(e.cssErrorStatus.borderColor=e.errorColor),void 0==e.cssErrorStatusResolved.borderColor&&(e.cssErrorStatusResolved.borderColor="")}function B(t,e,i){let o=I[e],a=o.cssActive,n=o.cssInactive,r=o.setCssInactive,s="radio"==i.attr(l),d=F(t);gsap.set(d,r),s?t.each(function(){let t=$(this);t.click(()=>{gsap.to(d,n),gsap.to(t[0],a)})}):t.each(function(){let t=$(this),e=!0,i=!1;t.click(()=>{i||(setTimeout(()=>{i=!1},10),e?(t.css(a),e=!1):(t.css(n),e=!0)),i=!0})})}function W(t,e,i){let o=t.find(r),n=t.find(".w-checkbox"),s=t.find('a, [bmg-form = "Continue Button"], .w-button').not('[bmg-form = "Not a Button"]').not(a),m=t.find("input"),c=parseInt(i.attr(d));return(t.attr(u,e),o.length>0)?(t.attr(l,"radio"),B(o,c,t),o.find("input").removeAttr("required"),void 0!=t.attr("bmg-data-not-auto-continue")?s:o):n.length>0?(t.attr(l,"checkbox"),B(n,c,t),s):m.length>0?(t.attr(l,"other input"),B(n,c,t),s):(t.attr(l,"empty"),s)}function K(t,e,i="false",o="false"){let a=t.find(e),n=t.children();return a.length>0?a:("false"!=o&&(n=n.not(o)),"false"!=i&&(n=n.eq(i)),n)}function F(t){let e=[];return t.each(function(){e.push(this)}),e}function V(t,e,i,o=!0){return"{}"==(t.attr(e)||"{}")?{...i}:JSON.parse(X(t.attr(e),!0))}function X(t,e=!0){let i=Y(t.replace(", ",",")).split(","),o="",a=i.length-1;return(i.forEach((t,e)=>{t.replace(/\'/g,"").replace(": ",":").split(":").forEach((t,e)=>{o+=`"${t}"${e>0?"":": "}`}),o+=e<a?", ":""}),e)?`{${o}}`:o}function Y(t){return t.substring(1).slice(0,-1)}function G(t){let e=t.attr("bmg-data-dev-mode"),i=0;return g.forEach(t=>{t.names.forEach(o=>{o==e&&(i=t.value)})}),i}function Q(){"undefined"==t?$.loadScript("https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/gsap.min.js",function(){z()}):z()}jQuery.loadScript=function(t,e){jQuery.ajax({url:t,dataType:"script",success:e,async:!0})},"undefined"==e?$.loadScript("https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js",function(){Q()}):Q()})();
